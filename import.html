<!DOCTYPE html>
<html lang="en>">
  <head>
    <title>Bob 3JS</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie-edge" />
    <style>
      body {
        margin: 0;
        height: 100vh;
      }
      canvas {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <canvas id="c"></canvas>
    <script src="./js/three.js"></script>
    <script type="module">
      // Find the latest version by visiting https://unpkg.com/three.
      import * as THREE from "./js/three.module.js";

      import { OrbitControls } from "./js/OrbitControls.js";
      import { GLTFLoader } from "./js/GLTFLoader.js";
      //import { FBXLoader } from "./js/FBXLoader.js";

      const canvas = document.querySelector("#c");
      const scene = new THREE.Scene();
      var renderer;

      renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
      //renderer.setClearColor(0xffffff);
      renderer.setPixelRatio(window.devicePixelRatio);
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      //   renderer.shadowMap.enabled = true;
      //   renderer.shadowMap.type = THREE.PCFSoftShadowMap;

      //   var light1 = new THREE.SpotLight(0xffffff);
      //   light1.position.set(30, 200, 300);
      //   //light1.rotation.y = 120;
      //   light1.castShadow = true;
      //   light1.target.position.set(0, 0, 0);
      //   light1.shadow.mapSize.width = 4096;
      //   light1.shadow.mapSize.height = 4096;
      //   light1.shadow.camera.near = 0.1;
      //   light1.shadow.camera.far = 900;
      //   light1.shadow.camera.left = -50;
      //   light1.shadow.camera.right = 50;
      //   light1.shadow.camera.top = 50;
      //   light1.shadow.camera.bottom = -50;

      //   scene.add(light1);
      //light1.shadow.focus = 1;

      //var light2 = new THREE.DirectionalLight(0xffffff, 2.0, 1000);
      //scene.add(light2);

      var light = new THREE.AmbientLight(0xffffff, 0.7);
      scene.add(light);

      //var material = new THREE.MeshLambertMaterial();
      const geometry = new THREE.PlaneGeometry(1000, 1000, 4, 4);
      const material = new THREE.MeshBasicMaterial();
      const mesh = new THREE.Mesh(geometry, material);
      mesh.rotation.x = (-90 * Math.PI) / 180;
      mesh.position.y = -10;
      mesh.receiveShadow = true;
      scene.add(mesh);

      const camera = new THREE.PerspectiveCamera(
        35,
        window.innerWidth / window.innerHeight,
        10,
        1000
      );
      camera.position.set(0, 20, 200);

      const controls = new OrbitControls(camera, renderer.domElement);
      controls.update();

      var light3 = new THREE.SpotLight(0xffffff);
      scene.add(light3);
      light3.castShadow = false;
      light3.position.set(200, 200, 200);
      light3.shadow.mapSize.width = 1024;
      light3.shadow.mapSize.height = 1024;

      light3.shadow.camera.near = 200;
      light3.shadow.camera.far = 400;
      light3.shadow.camera.fov = 300;

      //   const helper = new THREE.CameraHelper(light3.shadow.camera);
      //   scene.add(helper);

      //     LoadAnimatedModel() {
      //     const loader = new FBXLoader();
      //     loader.setPath('./resources/zombie/');
      //     loader.load('mremireh_o_desbiens.fbx', (fbx) => {
      //       fbx.scale.setScalar(0.1);
      //       fbx.traverse(c => {
      //         c.castShadow = true;
      //       });

      //       const params = {
      //         target: fbx,
      //         camera: this._camera,
      //       }
      //       this._controls = new BasicCharacterControls(params);

      //       const anim = new FBXLoader();
      //       anim.setPath('./resources/zombie/');
      //       anim.load('walk.fbx', (anim) => {
      //         const m = new THREE.AnimationMixer(fbx);
      //         this._mixers.push(m);
      //         const idle = m.clipAction(anim.animations[0]);
      //         idle.play();
      //       });
      //       this._scene.add(fbx);
      //     });
      //   }

      const loader = new GLTFLoader();
      var obj;
      loader.load(
        "./models/dance.glb",
        function (gltf) {
          gltf.scene.position.y = -10;
          gltf.scene.scale.set(20, 20, 20);
          scene.add(gltf.scene);
          light3.target = gltf.scene;
          obj = gltf.scene;
        },
        undefined,
        function (error) {
          console.error(error);
        }
      );

      render();

      var delta = 0;
      function render() {
        // delta += 0.01;

        // camera.lookAt(light3.position);
        // camera.position.x = Math.sin(delta) * 2000;
        // camera.position.z = Math.cos(delta) * 2000;
        renderer.render(scene, camera);
        //shadowMapViewer.render(renderer);

        // spmesh.rotation.x += 0.01;
        // spmesh.rotation.y += 0.01;
        // spmesh.rotation.z += 0.01;

        // light1.position.x += 1;
        // light1.position.y += 1;

        //spmesh.position.z += 0.5;

        // camera.position.x += 0.1;
        // camera.position.y += 0.1;

        // camera.rotation.z += 0.0001;
        // camera.rotation.x += 0.0001;
        // camera.rotation.y += 0.0001;

        controls.update();

        requestAnimationFrame(render);
        obj.rotation.y += 0.01;
      }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.7/dat.gui.js"></script>
    <!--<script src="./js/main.js"></script>-->
  </body>
</html>
